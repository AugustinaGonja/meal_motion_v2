{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="container my-5">
    <div class="mb-4 text-center">
        {% if not current_categories %}
        <h1>Recipe Catalogue</h1>
        {% else %}
        <h1 class="text-center">{{ category_objects.first.friendly_name }}</h1>
        {% endif %}
        <p>
            {% if search_term or current_categories or current_sorting %}
            <span><a class="link-offset-1" href="{% url 'recipes' %}">Recipe Catalogue</a> | </span>
            {% else %}
            <span><a class="link-offset-1" href="{% url 'home' %}">Return to Home</a> | </span>
            {% endif %}
            {{total_recipes}} Recipes {% if search_term %} found for "{{search_term}}"{% endif %}
        </p>
    </div>
    <hr>

    <!--Sort and Filter Buttons-->
    <div class="d-flex flex-column flex-sm-row justify-content-between gap-2">
        <button class="btn rounded-1 dropdown-toggle text-uppercase def-btn" type="button" id="sortDropdown"
            data-bs-toggle="dropdown" aria-expanded="false">
            Filter By Category
        </button>
        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
            <li><a class="dropdown-item" href="{% url 'recipes' %}?category=contains_meat">Meaty Dishes</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?category=high_protein">High Protein</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?category=vegetarian">Vegetarian</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?category=low_calorie">Low Cal</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?category=fish_and_seafood">Fish & Seafood</a></li>
        </ul>

        <button class="btn rounded-1 dropdown-toggle text-uppercase def-btn" type="button" id="sortDropdown"
            data-bs-toggle="dropdown" aria-expanded="false">
            {% if not request.GET.sort %}
            Sort By . . .
            {% else %}
            Sort By |
            {% if request.GET.sort == "category" %}
            Category ({% if request.GET.direction == "desc" %}Z-A{% else %}A-Z{% endif %})
            {% elif request.GET.sort == "name" %}
            Name ({% if request.GET.direction == "desc" %}Z-A{% else %}A-Z{% endif %})
            {% elif request.GET.sort == "rating" %}
            Rating
            {% endif %}
            {% endif %}
        </button>

        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
            <li><a class="dropdown-item" href="{% url 'recipes' %}?sort=name&direction=asc">Name
                    (A-Z)</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?sort=name&direction=des">Name
                    (Z-A)</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?sort=rating&direction=asc">Rating (Low-High)</a></li>
            <li><a class="dropdown-item" href="{% url 'recipes' %}?sort=rating&direction=desc">Rating (High-Low)</a></li>
        </ul>
    </div>
</div>
<div class="d-flex flex-column flex-sm-row justify-content-between gap-2">

</div>
</div>

<div class="container">
    <div class="row">
        {% for recipe in recipes %}
        <div class="col-md-3 mb-4">
            <!--Container contents wrapped in link to recipe details-->
            <a href="{% url 'recipe_details' recipe.id %}" class="text-dark text-decoration-none d-block">
                <div class="category-badge">
                    <i class="fa-solid fa-utensils me-2"></i>
                    {% for category in recipe.categories.all %}
                    {{ category.friendly_name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </div>
                {% if recipe.image %}
                <img src="{{ recipe.image_url }}" class="recipe-image w-100" alt="{{ recipe.name }}">
                {% else %}
                <img src="{% static 'no-image-icon-0.jpg' %}" class="recipe-image w-100" alt="No Image Available">
                {% endif %}
                <!--Recipe Info-->
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div class="d-flex flex-column">
                        <h5 class="fs-5 mb-2">{{ recipe.name }}</h5>
                        <p class="fw-bold mb-2">{{ recipe.nutritional_value.calories }} Kcal</p>
                        <small>
                            <strong>
                                <i class="fa-solid fa-star fa-xs" style="color: #FFD43B;"></i>
                                {{ recipe.rating }}/5
                            </strong>
                        </small>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<!--Back to Top Button-->
{% if recipes %}
<div class="d-flex justify-content-center">
    <button type="button" class="btn rounded-1 def-btn text-uppercase text-center mb-5" id="btt-btn"
        onclick="topFunction()">
        <i class="fa-solid fa-chevron-up mx-2"></i>
        Back to Top
    </button>
</div>
{% endif %}
<script>
    let bttButton = document.getElementById("btt-btn");

    bttButton.addEventListener("click", topFunction);

    function topFunction() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }
</script>
{% endblock %}